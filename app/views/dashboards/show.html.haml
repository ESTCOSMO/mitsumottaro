- subjects_size = @project.project_subjects.size
.project_id.hidden= @project.id
%h2= @project.name

%table
  %tr
    %th{rowspan: 2}
      大項目
    %th{rowspan: 2}
      中項目
    %th{rowspan: 2}
      小項目
    - @project.project_subjects.each do |ps|
      %th{colspan: 2}= ps.subject.name
  %tr
    - subjects_size.times do
      %th= "50%"
      %th= "90%"
  - @project.large_items.each do |l_item|
    %tr
      %td
        = l_item.name
        = '↑↓'
      - (subjects_size * 2 + 2).times do
        %td= '-'
    - l_item.medium_items.each do |m_item|
      %tr
        %td
        %td
          = m_item.name
          = '↑↓'
          - (subjects_size * 2 + 1).times do
            %td= '-'
      - m_item.small_items.each do |s_item|
        %tr
          %td
          %td
          %td
            = s_item.name
            = '↑↓'
          - @project.project_subjects.each do |ps|
            - sp = s_item.subject_points.find_by_project_subject_id(ps.id)
            - class_suffix = "#{l_item.id}_#{m_item.id}_#{s_item.id}_#{ps.id}"
            %td{class: "point_50_#{class_suffix}"}= sp.try(:point_50) || "-"
            %td{class: "point_90_#{class_suffix}"}= sp.try(:point_90) || "-"
      %tr
        %td
        %td
        %td= link_to "追加", new_project_large_item_medium_item_small_item_path(@project, l_item, m_item)
        - (subjects_size * 2).times do
          %td= '-'
    %tr
      %td
      %td= link_to "追加", new_project_large_item_medium_item_path(@project, l_item)
      - (subjects_size * 2 + 1).times do
        %td= '-'
  %tr
    %td= link_to "追加", new_project_large_item_path(@project)
    - (subjects_size * 2 + 2).times do
      %td= '-'

#point-modal.modal.hide.fade
  = form_for SubjectPoint.new, url: project_large_item_medium_item_small_item_subject_points_path("___PID___", "___LID___", "___MID___", "___SID___"), method: :post, remote: true do |f|
    .modal-header
      %button.close{"type" => "button", "data-dissmiss" => "modal", "aria-hidden" => true}
        &times;
      %h3
        Pointの登録
    .modal-body
      .alert.alert-error.hidden
      = f.text_field :point_50
      = f.text_field :point_90
      = f.hidden_field :project_subject_id
    .modal-footer
      = submit_tag "保存", class: "btn btn-primary"
      = submit_tag "削除", class: "btn"
      %a.btn.close_btn
        閉じる
